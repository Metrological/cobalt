# Copyright 2021 The Cobalt Authors. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import("//build/config/linux/pkg_config.gni")

declare_args() {
  has_ocdm = getenv("COBALT_HAS_OCDM")
  has_provision = getenv("COBALT_HAS_PROVISION")
  has_waylandsink = getenv("COBALT_HAS_WAYLANDSINK")
  cobalt_data_path = getenv("COBALT_DATA_PATH")
}

pkg_config("pkg_libs") {
  packages = [
    "WPEFrameworkCore",
    "WPEFrameworkDefinitions",
    "WPEFrameworkPlugins",
    "compositorclient",
    "WPEFrameworkDeviceInfo",
    "gstreamer-1.0",
    "gstreamer-app-1.0",
    "gstreamer-base-1.0",
    "gstreamer-video-1.0",
    "gstreamer-audio-1.0",
    "glib-2.0",
    "gobject-2.0",
  ]
  if (has_ocdm == "1") {
    packages += [ "ocdm" ]
  }
}

group("pkg_libs_grp") {
  public_configs = [ ":pkg_libs" ]
}

config("platform_configuration") {
  ldflags = [ 
    "-Wl,--wrap=eglGetDisplay"
  ]
  cflags = []
  if (has_ocdm == "1") {
    cflags += [
      "-DHAS_OCDM=1",
    ]
  }
  if (has_provision == "1") {
    cflags += [
      "-DHAS_PROVISION=1",
    ]
    ldflags += [
      "-Wl,--whole-archive",
      "-lWPEFrameworkProvisionProxy",
      "-lprovision",
      "-Wl,--no-whole-archive",
    ]
  }
  if (has_waylandsink == "1") {
    ldflags += [
      "-lgstwayland-1.0"
    ]
  }
  if (cobalt_data_path != "") {
    cflags += [
      "-DCOBALT_DATA_PATH=\"${cobalt_data_path}\"",
    ]
  }
}
